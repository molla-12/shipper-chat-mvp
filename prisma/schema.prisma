generator client {
  provider = "prisma-client-js"
  // Remove or comment out the output line
  // output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String              @id @default(cuid())
  name         String
  email        String              @unique
  image        String?
  messages     Message[]
  chatSessions ChatSessionUser[]   // Explicit relation
  createdAt    DateTime            @default(now())
}

model ChatSession {
  id        String              @id @default(cuid())
  users     ChatSessionUser[]   // Explicit relation
  messages  Message[]
  createdAt DateTime            @default(now())
}

// Explicit join table for many-to-many
model ChatSessionUser {
  user          User         @relation(fields: [userId], references: [id])
  userId        String
  chatSession   ChatSession  @relation(fields: [chatSessionId], references: [id])
  chatSessionId String
  joinedAt      DateTime     @default(now())

  @@id([userId, chatSessionId])
  @@unique([userId, chatSessionId])
}

model Message {
  id        String       @id @default(cuid())
  content   String
  senderId  String
  sessionId String
  sender    User         @relation(fields: [senderId], references: [id])
  session   ChatSession  @relation(fields: [sessionId], references: [id])
  createdAt DateTime     @default(now())
}